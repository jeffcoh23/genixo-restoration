# Genixo Restoration - Claude Playbook

> Instructions for working on this Rails + Inertia + Vite + Tailwind v4 project.

**Project Docs:**
- [Schema](docs/SCHEMA.md) - Every table, column, relationship, and index
- [Architecture](docs/ARCHITECTURE.md) - Technical decisions, service objects, key flows
- [Business Rules](docs/BUSINESS_RULES.md) - Domain logic, permissions, edge cases
- [Design System](docs/DESIGN.md) - Colors, typography, components
- [Code Quality](docs/CODE_QUALITY.md) - Rules for writing clean, maintainable code
- [Testing Guidelines](docs/TESTING.md) - Principles for writing excellent tests
- [Project Setup](docs/PROJECT_SETUP.md) - Local dev, deploy
- [Roadmap](docs/ROADMAP.md) - Feature priorities

**Rails Playbook:** `~/.claude/rails-playbook/README.md` — standard patterns for auth, Inertia, Solid Stack, deployment. Don't duplicate playbook patterns in project docs.

---

## Stack

| Layer | Technology |
|-------|------------|
| Server | Rails 8 + PostgreSQL |
| Frontend | Inertia + React + Vite |
| Styling | Tailwind v4 + shadcn/ui |
| Auth | Rails 8 sessions (email/password only, no OAuth) |
| Jobs | Solid Queue (single-database) |
| Cache | Solid Cache |
| Email | ActionMailer + Resend (letter_opener_web in dev) |
| Notifications | Provider-agnostic (SMS/voice TBD — Twilio, Vonage, etc.) |
| File Storage | Active Storage (local dev, S3 production) |
| Hosting | Heroku |

**Not used:** Stripe, OAuth, ActionCable (all deferred post-MVP).

---

## Domain Context

Multi-tenant incident management for property restoration (water damage, fire, etc.).

- **Mitigation Org** — service provider that does restoration work
- **PM Org** — property management company (client)
- **Property** — physical building, owned by PM org, serviced by mitigation org
- **Incident** — a restoration job on a property, tracked from intake through payment

Two org types, six user roles. See `docs/BUSINESS_RULES.md` for full access control.

---

## Quick Reference

### Commands
```bash
bin/dev              # Start dev server
bin/rails test       # Run tests
bin/rails console    # Rails console
```

### Key Paths
- Pages: `app/frontend/pages/`
- Components: `app/frontend/components/`
- Services: `app/services/`
- Models: `app/models/`
- Jobs: `app/jobs/`
- Mailers: `app/mailers/`
- Styles: `app/frontend/entrypoints/application.css`

### Conventions
- Internal links: `<Link href={routes.X} />` (Inertia)
- Routes: Always use shared routes from `usePage().props.routes`
- Icons: Lucide React only
- Components: shadcn/ui
- Colors: Tailwind v4 tokens (`bg-background`, not `bg-white`)
- Business logic: Always in `app/services/`, never in controllers or models
- Activity logging: Always use `ActivityLogger.log()` — never create activity_events or touch `last_activity_at` directly
- Authorization: Always scope through `visible_incidents` / `visible_properties` — never `Incident.find(id)` directly
- Timestamps: Stored UTC, displayed in user's timezone via `Time.use_zone`

### Frontend Design
When building pages, components, or layouts, use the `/frontend-design` skill to generate distinctive, production-grade UI. Avoids generic AI aesthetics and uses the project's design system (Tailwind v4 + shadcn/ui).

---

## Development Workflow

### Branching & Commits

1. Create a feature branch from `main`: `git checkout -b feature/short-description`
2. Work in small commits — each commit should be a logical unit
3. Run `bin/rails test` before every commit — all tests must pass
4. Push branch and open PR when feature is complete
5. Merge to `main` after review

### When to Write Tests

- **Service/model tests** — write as you build each service
- **Controller tests** — write as you build each controller
- **E2E system tests** — write after the feature works end-to-end (Capybara + Playwright)
- Never commit with failing tests

### Test Stack

| Layer | Tool | Purpose |
|-------|------|---------|
| Services + Models | Minitest | Business logic, validations, scopes |
| Controllers | Minitest + Inertia helpers | Authorization scoping, correct component/props per role |
| E2E (System) | Capybara + Playwright | Critical happy paths in real browser |

---

## Non-Negotiables

1. Small tasks (30-90 min chunks)
2. Tests for behavior changes
3. Never hardcode routes
4. Use ENV for all secrets
5. Update docs when adding features
6. All authorization via scoped queries — never trust URL params
7. All status transitions via `StatusTransitionService` — never update status directly
8. Polymorphic attachments for everything (incidents + messages)
9. Provider-agnostic notification interface — never call Twilio/etc. directly


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 14, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #2126 | 4:31 PM | ✅ | Added CODE_QUALITY.md documentation reference to project navigation | ~484 |
| #2122 | 4:23 PM | ✅ | Testing Guidelines Documentation Added to CLAUDE.md Reference Links | ~535 |
| #2118 | 4:17 PM | ✅ | Email Provider Specified as Resend for Production | ~532 |
</claude-mem-context>